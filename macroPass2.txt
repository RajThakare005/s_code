Macro Pass 2 :

import java.io.*;
 import java.util.*;
 public class MacroPass2 { public static void main(String args[]) throws IOException { BufferedReader brInput, brMNT, brMDT, brADT; PrintWriter pwOut; String inputLine, macroName, arg; String mntName[] = new String[20]; int mdtIndex[] = new int[20]; int mntCount = 0; String mdtLines[] = new String[100]; int mdtCount = 0; String adtName[] = new String[20]; int adtCount = 0; brInput = new BufferedReader(new FileReader("Input.txt")); brMNT = new BufferedReader(new FileReader("mnt.txt")); brMDT = new BufferedReader(new FileReader("mdt.txt")); brADT = new BufferedReader(new FileReader("adt.txt")); pwOut = new PrintWriter(new FileWriter("Pass2Output.txt")); while ((inputLine = brMNT.readLine()) != null) { StringTokenizer st = new StringTokenizer(inputLine, "\t"); if (st.countTokens() >= 2) { mntName[mntCount] = st.nextToken(); mdtIndex[mntCount] = Integer.parseInt(st.nextToken()); mntCount++; } } while ((inputLine = brMDT.readLine()) != null) { mdtLines[mdtCount++] = inputLine; } while ((inputLine = brADT.readLine()) != null) { adtName[adtCount++] = inputLine; } while ((inputLine = brInput.readLine()) != null) { StringTokenizer st = new StringTokenizer(inputLine, " ,\t"); if (!st.hasMoreTokens()) continue; String firstToken = st.nextToken(); int macroFound = -1; for (int i = 0; i < mntCount; i++) { if (firstToken.equalsIgnoreCase(mntName[i])) { macroFound = i; break; } } if (macroFound != -1) { String actualArgs[] = new String[adtCount]; int aCount = 0; while (st.hasMoreTokens()) { actualArgs[aCount++] = st.nextToken(); } int start = mdtIndex[macroFound]; for (int i = start; i < mdtCount; i++) { String mLine = mdtLines[i]; if (mLine.equals("MEND")) break; for (int j = 0; j < aCount; j++) { mLine = mLine.replace("AR" + j, actualArgs[j]); } pwOut.println(mLine); } } else { pwOut.println(inputLine); } } brInput.close(); brMNT.close(); brMDT.close(); brADT.close(); pwOut.close(); System.out.println("Macro Pass 2 completed. Output written to Pass2Output.txt"); } }
